**University** : [ITMO University](https://itmo.ru/ru/)

**Faculty** : [FICT](https://fict.itmo.ru)

**Course** : [Cloud platforms as the basis of technology entrepreneurship](https://itmo-ict-faculty.github.io/cloud-platforms-as-the-basis-of-technology-entrepreneurship/)

**Year**: 2024/2025

**Group** : U4225

**Author** : Semykina Vera Stanislavovna

**Lab**: Lab3

**Date of create**: 09.11.2024

**Date of finished** : 09.11.2024

# Лабораторная работа №4: "Разработка инфраструктуры MVP AI приложения."

## Цель работы:
Создать прототип AI-приложения с базовой функциональностью.

# Ход работы:

## 1. Описание проекта
### Подбор музыки по настроению
Приложение, которое подбирает музыку или плейлисты в зависимости от настроения пользователя, основываясь на анализе текстов и введенной информации.

#### Начальное состояние:
пользователь выбирает настроение (например, спокойствие, энергичность, грусть), и приложение предлагает простой плейлист из предварительно заданных песен.
#### Тестирование с партнёрами: 
добавление функциональности для анализа загружаемых песен и настройки рекомендаций по предпочтениям пользователя.
#### Продовое решение: 
подключение к потоковым сервисам, персонализированные плейлисты, возможность сохранения плейлистов и добавление новых настроений.

## 2. Логика приложения
Базовый функционал приложения включает в себя следующие основные компоненты:
1. Выбор и анализ настроения.
2. Подбор музыки на основе заданных метаданных треков.
3. Воспроизведение музыки через встроенный плеер.
4. Оценка треков (лайки/дизлайки) для будущей персонализации.
5. Уведомления и простая аналитика по предпочтениям пользователя.

### 1. **Выбор настроения**
   - **Интерфейс для выбора настроения**: Пользователь может выбрать свое текущее настроение из заранее заданного списка (например, спокойствие, счастье, грусть, мотивация) или может ввести свое описание настроения.
   - **Анализ настроения**: Если пользователь вводит текстовое описание, приложение использует NLP (обработку естественного языка) для распознавания ключевых слов и анализа, чтобы определить основное настроение.

### 2. **Подбор музыки на основе настроения**
   - **Каталог музыки**: Приложение включает в себя базу данных с треками, которые предварительно распределены по категориям настроения. Каждый трек имеет метаданные (жанр, темп, настроение), что позволяет находить соответствующие композиции.
   - **Рекомендация плейлиста**: На основе выбранного настроения приложение генерирует плейлист из соответствующих треков, которые пользователи могут воспроизвести внутри приложения.

### 3. **Прослушивание музыки**
   - **Встроенный аудиоплеер**: Приложение предоставляет базовый аудиоплеер для воспроизведения треков из плейлиста. Пользователь может приостановить, возобновить или переключить трек.
   - **Интеграция с музыкальными платформами** (опционально): Для более продвинутой версии можно предусмотреть интеграцию с популярными музыкальными платформами (например, Spotify), что позволит пользователю прослушивать полные версии треков и сохранять плейлисты.

### 4. **Оценка рекомендаций**
   - **Система лайков и дизлайков**: Пользователь может оценить трек с помощью лайка или дизлайка. Лайки добавляют трек в избранное, а дизлайки сигнализируют приложению, что пользователь предпочитает не слушать этот трек.
   - **Обучение на основе предпочтений**: Приложение запоминает, какие треки пользователю нравятся, и учитывает это для подбора музыки в будущем. На базе оценок приложение постепенно обучается лучше подбирать композиции.

### 5. **Уведомления и напоминания**
   - **Уведомления о новых подборках**: Приложение может отправлять уведомления с новыми подборками музыки для текущего настроения пользователя.
   - **Ежедневные рекомендации**: По желанию пользователя можно настроить ежедневные уведомления с предложением плейлистов на основе его активности и привычек.

### 6. **Простая аналитика прослушиваний**
   - **История прослушиваний**: Приложение сохраняет историю прослушиваний, чтобы пользователь мог вернуться к понравившимся плейлистам.
   - **Отчеты по настроению**: Отчеты показывают, какие настроения пользователь выбирал чаще всего и какая музыка поднимала ему настроение, что может быть полезно для создания более точных рекомендаций.

## 3. Схема инфраструктуры приложения
![rus xml схема drawio](https://github.com/user-attachments/assets/c26c8891-aa51-4d81-a508-0a8f5a4e0c27)

### Логика работы приложения в соответствии с приведенной схемой заключается в следующем:
Работа приложения начинается с выбора пользователем настроения. Эта информация анализируется через NLP Service и передается в Recommendation Engine, который на основании настроения и предыдущих предпочтений находит треки в базе данных и хранилище. При необходимости движок обращается к внешнему API для получения дополнительного контента. Пользователь может воспроизвести и оценить плейлист, что поможет улучшить будущие рекомендации. Аналитика и уведомления поддерживают вовлеченность пользователя, предлагая персонализированные плейлисты и рекомендации.

1. **Интерфейс пользователя (Frontend Приложение)**:
   - **Функция**: Интерфейс взаимодействия с пользователем, позволяющий выбрать настроение, прослушивать музыку и оценивать треки.
   - **Процесс**: Пользователь выбирает настроение из списка (например, спокойствие, радость, мотивация) или вводит его описание. Выбор настроения отправляется на backend через **API Gateway**.

2. **API Gateway**:
   - **Функция**: API Gateway выступает как центральный узел для обработки всех запросов от интерфейса и их маршрутизации к нужным backend-сервисам.
   - **Процесс**: API Gateway перенаправляет запросы к таким компонентам, как **NLP Service** (анализ настроения), **Recommendation Engine** (генерация плейлистов) и **Notification Service**.
   - **Маршрутизация и управление**: Компонент обеспечивает аутентификацию и безопасное управление запросами, используя, например, Yandex API Gateway или Nginx.

3. **Сервис NLP (Обработка текста)**:
   - **Функция**: Анализ текста, введенного пользователем для определения настроения.
   - **Процесс**: Если пользователь вводит текстовое описание настроения, **API Gateway** перенаправляет его в NLP Service, который использует, например, Yandex SpeechKit или SberCloud SmartSpeech для анализа и выделения ключевых индикаторов настроения.
   - **Результат**: NLP Service возвращает определенное настроение (например, «радость», «спокойствие»), которое передается в **Recommendation Engine** для подбора музыки.

4. **Рекомендательный движок (Recommendation Engine)**:
   - **Функция**: Создает музыкальные плейлисты на основе настроения и предпочтений пользователя.
   - **Процесс**: Recommendation Engine принимает данные о настроении от NLP Service или от интерфейса и обращается к **Базе данных** для получения подходящих треков, учитывая предпочтения пользователя.
   - **Подключения**: 
     - Обращается к **Базе данных** для получения данных и информации о предпочтениях.
     - Получает музыкальные файлы или ссылки из **Хранилища музыкального контента**.
   - **Результат**: Движок генерирует плейлист по настроению и передает его пользователю. Также сохраняет оценки треков (лайк/дизлайк) в базе данных для улучшения будущих рекомендаций.

5. **База данных (Данные пользователей и метаданные музыки)**:
   - **Функция**: Хранит данные о пользователях, их предпочтениях и метаданные треков (жанр, настроение и т.д.).
   - **Процесс**: 
     - Recommendation Engine получает доступ к базе данных для персонализированных рекомендаций.
     - База данных также хранит действия пользователя для улучшения рекомендаций.
   - **Аналитика**: База данных подключена к **Сервису аналитики**, который отслеживает популярность контента и пользовательские тренды.

6. **Хранилище музыкального контента**:
   - **Функция**: Хранит музыкальные файлы или ссылки на контент.
   - **Процесс**: Если Recommendation Engine должен воспроизвести конкретный трек, он получает его из **Yandex Object Storage** или **VK Cloud Object Storage**.
   - **Расширенные опции**: При необходимости больше треков движок обращается к **Внешнему музыкальному API**.

7. **Сервис аналитики (Analytics Service)**:
   - **Функция**: Отслеживает предпочтения пользователей, популярность треков и общие тенденции.
   - **Процесс**: Сервис аналитики получает данные от базы данных и API Gateway, собирая метрики, такие как часто выбираемые настроения и популярные треки.
   - **Результат**: Эти данные передаются в Recommendation Engine, что помогает улучшить рекомендации.

8. **Внешний музыкальный API (например, VK Music API)**:
   - **Функция**: Обеспечивает доступ к дополнительному музыкальному контенту за пределами основного хранилища.
   - **Процесс**: Если движку требуются дополнительные треки, он обращается к **VK Music API** или аналогичному сервису для получения подходящего контента.
   - **Использование**: Интеграция с внешним API позволяет расширить музыкальную библиотеку без необходимости хранить обширный контент локально.

9. **Сервис уведомлений (Notification Service)**:
   - **Функция**: Отправляет персонализированные уведомления пользователям, например, рекомендации по новому плейлисту.
   - **Процесс**: Подключен к API Gateway, Notification Service отправляет уведомления в зависимости от активности пользователя или новых рекомендаций.
   - **Инструменты**: Можно использовать VK Cloud Messaging или SberCloud Messaging для надежной доставки уведомлений.

## 3. Сервисы и компаненты
Оновное ограничительное условия для выбора сервисов стала география располодения разработчиков и георгафический рынок использования прилодения. Налоим условия, чт ои разработчики и  рынок российские. 

### 1. **User Interface (Frontend App)**

   - **Описание**: Интерфейс взаимодействия с пользователем, предоставляющий функции выбора настроения, воспроизведения музыки и оценок треков.
   - **Инструменты для разработки**: 
     - **React, Vue.js или Angular** — популярные библиотеки и фреймворки для создания интерфейсов.
     - **WebSocket или REST API** — для взаимодействия с backend через API Gateway.
     - **VK Mini Apps** — если приложение интегрируется с экосистемой VK, это упрощает разработку под VK ID и предоставляет доступ к VK API.

### 2. **API Gateway**

   - **Описание**: Центральный компонент, обрабатывающий запросы от интерфейса и направляющий их к соответствующим сервисам (NLP, Recommendation Engine, Notification и др.).
   - **Примеры**:
     - **Nginx или Traefik** — open-source решения для API Gateway, которые можно развернуть на российских серверах.
     - **Yandex API Gateway** — сервис Яндекса для управления API, подходит для интеграции с другими сервисами Яндекса.
     - **Kong** (self-hosted) — API Gateway с расширенными возможностями, можно развернуть локально.

### 3. **NLP Service (Обработка текста)**

   - **Описание**: Анализ текста для определения настроения пользователя по введённому описанию.
   - **Примеры**:
     - **Yandex SpeechKit** — предоставляет возможности NLP и распознавания текста для анализа настроения.
     - **SberCloud SmartSpeech** — сервис от Сбера с NLP и синтезом речи, хорошо подходит для российских разработчиков.
     - **MTS AI** — NLP-сервисы от МТС с поддержкой анализа текста и распознавания настроения.

### 4. **Recommendation Engine (Рекомендательный движок)**
   - **Описание**: Компонент, который подбирает музыку на основе предпочтений и настроения пользователя.
   - **Примеры**:
     - **VK Cloud Solutions или Yandex DataSphere** — инфраструктуры для создания и обучения рекомендательных моделей в российских дата-центрах.
     - **Собственная разработка** — рекомендательные алгоритмы, разработанные на базе Python (например, с использованием библиотек scikit-learn или TensorFlow), размещенные на российских серверах для полного контроля.

### 5. **База данных (Данные пользователей и метаданные музыки)**
   - **Описание**: Хранит данные о пользователях, их предпочтениях и метаданные музыкальных треков.
   - **Примеры**:
     - **Yandex Managed Databases** — управляемые базы данных (PostgreSQL, MongoDB) от Яндекса.
     - **VK Cloud Databases** — поддержка различных баз данных, включая PostgreSQL и MySQL.
     - **ClickHouse** — аналитическая база данных от Яндекса, идеально подходит для высокопроизводительной обработки данных.

### 6. **Music Content Storage (Хранилище музыкальных файлов)**
   - **Описание**: Хранилище аудиофайлов или ссылок на музыкальный контент.
   - **Рекомендации**:
     - **Yandex Object Storage** — сервис для хранения больших объемов данных, таких как аудиофайлы.
     - **VK Cloud Object Storage** — аналогичное решение для хранения и доступа к музыкальному контенту.
     - **MinIO** (self-hosted) — объектное хранилище с поддержкой S3, которое можно развернуть локально.

### 7. **Analytics Service (Сервис аналитики)**

   - **Описание**: Сервис для сбора аналитических данных о предпочтениях пользователей, прослушиваемых треках и общей статистики.
   - **Рекомендации**:
     - **Yandex Metrica** — мощный инструмент для сбора данных о пользователях и аналитики, поддерживающий отслеживание поведения пользователей.
     - **VK Cloud Solutions Analytics** — для детальной аналитики и отслеживания трендов в данных.
     - **Matomo (self-hosted)** — open-source система аналитики, которую можно развернуть на собственных серверах.

### 8. **External Music API (Внешний музыкальный API)**
   - **Описание**: API для доступа к большему количеству музыкального контента.
   - **Рекомендации**:
     - **VK Music API** — при доступе к VK экосистеме можно использовать VK Music для интеграции музыки.
     - **Яндекс.Музыка API** — ограниченный доступ, требует согласования, но может стать источником контента.

### 9. **Notification Service (Сервис уведомлений)**

   - **Описание**: Сервис для отправки push-уведомлений пользователям, таких как рекомендации плейлистов.
   - **Рекомендации**:
     - **VK Cloud Messaging** — для отправки push-уведомлений пользователям на российском рынке.
     - **SberCloud Messaging** — альтернатива от Сбера для уведомлений.
     - **Firebase Cloud Messaging** (ограниченно) — если приложение поддерживается на устройствах пользователей в России.

### Итоговая инфраструктура для российского рынка

- **Frontend**: React/Vue.js/Angular для пользовательского интерфейса, WebSocket для взаимодействия.
- **Backend и API Gateway**: Nginx или Yandex API Gateway для маршрутизации и контроля.
- **NLP**: Yandex SpeechKit или SberCloud SmartSpeech для обработки текстов.
- **Recommendation Engine**: Собственный алгоритм или Yandex DataSphere для рекомендаций.
- **Database**: Yandex Managed Databases или ClickHouse для хранения данных.
- **Music Storage**: Yandex Object Storage или VK Cloud Storage для хранения контента.
- **Analytics**: Yandex Metrica или Matomo для анализа данных.
- **Notification Service**: VK Cloud Messaging или SberCloud Messaging для уведомлений.
  
## Экономическая модель
### Этап 1: Начальное состояние
На начальном этапе приложение разрабатывается и тестируется с минимальной нагрузкой. Цель - развернуть основные ресурсы и протестировать базовую функциональность.

| Этап           | Ресурс                    | Характеристика                                          | Стоимость в месяц |
|----------------|---------------------------|---------------------------------------------------------|--------------------|
| Начальное      | API Gateway               | Nginx или Yandex API Gateway (1 инстанс)                 | 500 ₽             |
|                | NLP Service               | Yandex SpeechKit API (на обработку текста)               | 1 000 ₽           |
|                | Recommendation Engine     | Yandex DataSphere (минимальный пакет, 2 виртуальные CPU) | 3 000 ₽           |
|                | Database                  | Yandex Managed Databases (PostgreSQL, 10 ГБ)            | 2 000 ₽           |
|                | Music Content Storage     | Yandex Object Storage (10 ГБ, основное хранилище)       | 500 ₽             |
|                | Analytics Service         | Yandex Metrica (бесплатная версия)                       | 0 ₽               |
|                | Notification Service      | VK Cloud Messaging (до 10 000 сообщений)                 | 500 ₽             |
| **Итого**      |                           |                                                         | **7 500 ₽**       |

### Этап 2: Тестирование с партнёрами
На этапе тестирования с партнёрами планируется нагрузка на бóльшее количество пользователей, что требует увеличения ресурсов и большей устойчивости. Цель – оптимизировать пользовательский опыт.

| Этап                    | Ресурс                    | Характеристика                                                 | Стоимость в месяц |
|-------------------------|---------------------------|----------------------------------------------------------------|--------------------|
| Тестирование партнёрами | API Gateway               | Yandex API Gateway (2 инстанса, резервирование)                | 1 000 ₽           |
|                         | NLP Service               | Yandex SpeechKit API (увеличение лимита на запросы)            | 2 000 ₽           |
|                         | Recommendation Engine     | Yandex DataSphere (минимальный пакет, 4 виртуальные CPU)       | 6 000 ₽           |
|                         | Database                  | Yandex Managed Databases (PostgreSQL, 20 ГБ)                   | 3 500 ₽           |
|                         | Music Content Storage     | Yandex Object Storage (30 ГБ, дополнительно к хранилищу)       | 1 500 ₽           |
|                         | Analytics Service         | Yandex Metrica (бесплатная версия, более продвинутый пакет)    | 500 ₽             |
|                         | Notification Service      | VK Cloud Messaging (до 20 000 сообщений)                       | 1 000 ₽           |
| **Итого**               |                           |                                                                | **15 500 ₽**      |

### Этап 3: Продовое решение
Для продового решения рассчитываются расходы при условии, что приложение обрабатывает запросы для активной пользовательской базы, что требует максимальной масштабируемости и отказоустойчивости.

| Этап         | Ресурс                    | Характеристика                                                    | Стоимость в месяц |
|--------------|---------------------------|-------------------------------------------------------------------|--------------------|
| Продовое     | API Gateway               | Yandex API Gateway (минимум 3 инстанса, с масштабированием)       | 3 000 ₽           |
|              | NLP Service               | Yandex SpeechKit API (большой лимит запросов)                     | 5 000 ₽           |
|              | Recommendation Engine     | Yandex DataSphere (4 виртуальные CPU, расширение на запросы)      | 10 000 ₽          |
|              | Database                  | Yandex Managed Databases (PostgreSQL, 50 ГБ, масштабируемая)      | 8 000 ₽           |
|              | Music Content Storage     | Yandex Object Storage (100 ГБ для музыкального контента)          | 5 000 ₽           |
|              | Analytics Service         | Yandex Metrica (полный пакет аналитики)                           | 1 000 ₽           |
|              | Notification Service      | VK Cloud Messaging (до 100 000 сообщений)                         | 3 000 ₽           |
| **Итого**    |                           |                                                                   | **35 000 ₽**      |

### Итоги
1. **Начальное состояние**: На этом этапе важно развернуть минимальные ресурсы для тестирования функционала, что позволяет снизить начальные затраты до **7 500 ₽**.
2. **Тестирование с партнёрами**: На этапе тестирования требуется увеличенная стабильность и резервирование ресурсов, что увеличивает затраты до **15 500 ₽**.
3. **Продовое решение**: В продовом состоянии с активной пользовательской базой расходы возрастают до **35 000 ₽** в месяц.
